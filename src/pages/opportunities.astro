---
import Layout from '../components/Layout.astro';
import { getAllJobs } from '../data/jobs.js';

const jobs = getAllJobs();
---

<Layout title="Opportunities" currentPage="opportunities">
    <div class="jobs-container grid-2">
        {jobs.map(job => (
            <div class="card card-medium job-card" data-job-id={job.id}>
                <h3 class="title">{job.title}</h3>
                <div class="tags">
                    {job.tags.map(tag => (
                        <span class="tag">{tag}</span>
                    ))}
                </div>
                <div class="job-details">
                    <span class="salary">{job.salary}</span>
                    <span class="location">{job.location}</span>
                </div>
                <button class="btn btn-full mt-auto apply-btn">Apply</button>
            </div>
        ))}
    </div>

    <script is:inline>
        // Job card navigation functionality
        function initJobCardNavigation() {
            console.log('Setting up job card navigation...');
            const jobCards = document.querySelectorAll('.job-card');
            console.log(`Found ${jobCards.length} job cards`);
            
            // Add click listeners to job cards for navigation
            jobCards.forEach(card => {
                const jobId = card.dataset.jobId;
                console.log(`Setting up card with job ID: ${jobId}`);
                
                // Add visual feedback immediately
                card.style.cursor = 'pointer';
                
                // Add hover effect for better UX
                card.addEventListener('mouseenter', () => {
                    card.style.transform = 'translateY(-2px)';
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'translateY(0)';
                });
                
                card.addEventListener('click', (e) => {
                    console.log('Job card clicked!', jobId);
                    
                    // Don't navigate if apply button was clicked
                    if (e.target.closest('.apply-btn')) {
                        console.log('Apply button clicked, not navigating');
                        e.stopPropagation();
                        return;
                    }
                    
                    // Temporary alert for testing
                    alert(`Clicked job: ${jobId}. This will navigate to /opportunities/${jobId}`);
                    
                    if (jobId) {
                        const url = `/opportunities/${jobId}`;
                        console.log(`Navigating to: ${url}`);
                        window.location.href = url;
                    } else {
                        console.error('No job ID found for card');
                    }
                });
            });
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initJobCardNavigation);
        } else {
            initJobCardNavigation();
        }
    </script>
</Layout> 